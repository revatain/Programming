CREATE TABLE SCOTT."USER" (
	IDX NUMBER NOT NULL,
	NAME VARCHAR2(100) NOT NULL,
	TEL VARCHAR2(100) NOT NULL,
	CONSTRAINT USER_PK PRIMARY KEY (IDX),
	CONSTRAINT USER_UN_TEL UNIQUE (TEL)
);
COMMENT ON COLUMN SCOTT."USER".IDX IS '인덱스';
COMMENT ON COLUMN SCOTT."USER".NAME IS '이름';
COMMENT ON COLUMN SCOTT."USER".TEL IS '전화번호';

CREATE TABLE SCOTT.BOOK (
	IDX NUMBER NOT NULL,
	"COMMENT" VARCHAR2(100) NOT NULL,
	USER_IDX NUMBER NOT NULL,
	CONSTRAINT BOOK_PK PRIMARY KEY (IDX),
	CONSTRAINT FK_USER FOREIGN KEY (USER_IDX) REFERENCES SCOTT."USER"(IDX) ON DELETE CASCADE
);
COMMENT ON COLUMN SCOTT.BOOK.IDX IS '인덱스';
COMMENT ON COLUMN SCOTT.BOOK."COMMENT" IS '내용';
COMMENT ON COLUMN SCOTT.BOOK.USER_IDX IS '외래키';

CREATE TABLE SCOTT.LOG (
	IDX NUMBER NOT NULL,
	BOOK_IDX NUMBER NOT NULL,
	VISIT_DATE DATE DEFAULT SYSDATE NOT NULL,
	CONSTRAINT LOG_PK PRIMARY KEY (IDX),
	CONSTRAINT FK_BOOK FOREIGN KEY (BOOK_IDX) REFERENCES SCOTT.BOOK(IDX)
);
COMMENT ON COLUMN SCOTT.LOG.IDX IS '인덱스';
COMMENT ON COLUMN SCOTT.LOG.BOOK_IDX IS '방명록 외래키';
COMMENT ON COLUMN SCOTT.LOG.VISIT_DATE IS '글쓴날짜';

CREATE SEQUENCE SCOTT.USER_SEQ INCREMENT BY 1 MINVALUE 1 NOCYCLE NOCACHE NOORDER;

CREATE SEQUENCE SCOTT.BOOK_SEQ INCREMENT BY 1 MINVALUE 1 NOCYCLE NOCACHE NOORDER;

CREATE SEQUENCE SCOTT.LOG_SEQ INCREMENT BY 1 MINVALUE 1 NOCYCLE NOCACHE NOORDER;

CREATE OR REPLACE TRIGGER SCOTT.LOG_TRIGGER
AFTER INSERT ON SCOTT.BOOK
FOR EACH ROW
BEGIN
	INSERT INTO SCOTT.LOG values(LOG_SEQ.NEXTVAl, BOOK_SEQ.CURRVAL, SYSDATE);
END;


INSERT INTO "USER" VALUES (USER_SEQ.NEXTVAL, '홍길동', '01099241841');

INSERT INTO BOOK VALUES (BOOK_SEQ.NEXTVAl, '내용', 1);